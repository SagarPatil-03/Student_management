<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Student CRUD</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
<div class="container mt-4">

<h3 class="text-center">Student Management</h3>

<div class="card p-3 mb-3">
<input type="hidden" id="id">
<input class="form-control mb-2" id="name" placeholder="Name">
<input class="form-control mb-2" id="email" placeholder="Email">
<input class="form-control mb-2" id="age" placeholder="Age">
<button class="btn btn-success" onclick="saveStudent()">Save</button>
</div>

<table class="table table-bordered">
<thead class="table-dark">
<tr>
<th>ID</th><th>Name</th><th>Email</th><th>Age</th><th>Action</th>
</tr>
</thead>
<tbody id="data"></tbody>
</table>

</div>

<script>

const API = "http://localhost:8085/api/students";  // âœ… FULL URL

// LOAD DATA
function loadStudents() {
fetch(API)
.then(res => res.json())
.then(data => {
let rows = "";
data.forEach(s => {
rows += `
<tr>
<td>${s.id}</td>
<td>${s.name}</td>
<td>${s.email}</td>
<td>${s.age}</td>
<td>
<button class="btn btn-warning btn-sm"
onclick="editStudent(${s.id}, '${s.name}', '${s.email}', ${s.age})">Edit</button>

<button class="btn btn-danger btn-sm"
onclick="deleteStudent(${s.id})">Delete</button>
</td>
</tr>`;
});
document.getElementById("data").innerHTML = rows;
});
}

// SAVE OR UPDATE
function saveStudent() {

let id = document.getElementById("id").value;

let student = {
name: document.getElementById("name").value,
email: document.getElementById("email").value,
age: document.getElementById("age").value
};

let method = id ? "PUT" : "POST";
let url = id ? API + "/" + id : API;

fetch(url, {
method: method,
headers: { "Content-Type": "application/json" },
body: JSON.stringify(student)
})
.then(response => {
if (!response.ok) {
alert("Error: " + response.status);
}
return response.json();
})
.then(() => {
clearForm();
loadStudents();
});
}

// EDIT
function editStudent(id, name, email, age) {
document.getElementById("id").value = id;
document.getElementById("name").value = name;
document.getElementById("email").value = email;
document.getElementById("age").value = age;
}

// DELETE
function deleteStudent(id) {
fetch(API + "/" + id, { method: "DELETE" })
.then(response => {
if (!response.ok) {
alert("Delete failed: " + response.status);
}
loadStudents();
});
}

// CLEAR FORM
function clearForm() {
document.getElementById("id").value = "";
document.getElementById("name").value = "";
document.getElementById("email").value = "";
document.getElementById("age").value = "";
}

loadStudents();

</script>
</body>
</html>
